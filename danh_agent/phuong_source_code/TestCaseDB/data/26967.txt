#ID: 26967 

#bin:
ibcf 7.2.52

#config:
[PEER_valid_auto_ext]
SIP_MANIPULATION[] = SET_ALLOW
Authorization_profile = 0
Max_in = 65550
Max_out = 65550
Hiding = NO_HIDING
Media_Profile = 19
Routing_profile = 0
behavior = 7
Trusted = TRUE
Privacy = FALSE
Fields_Filtering = NONE
Domain[] = 192.168.33.33:5022

[ MANIPULATION_RULE_DEL-ALLOW-INSTANCE1 ]
Instance = "^"
Action_Type = Del
Element_Type = HEADER-VALUE
Header_Name = Allow

[ SIP_MANIPULATION_PROFILE_SET_ALLOW ]
Manipulation[] = DEL-ALLOW-INSTANCE1
Applicability = BOTH
Method_Type[] = "*"
Message_Type = BOTH
Strategy = IN

#Message:
(11:15:05.88) W0 in <192.168.33.157:5681> <- 809 bytes from <192.168.33.163:5022>
INVITE sip:0167000000@192.168.33.157:5681 SIP/2.0
To: Called <sip:0167000000@192.168.33.157>
From: Calling <sip:0166000000@192.168.33.163>;tag=1-1-1
Via: SIP/2.0/UDP 192.168.33.163:5022;branch=z9hG4bK-13293-1-1
Call-ID: 1-13293@192.168.33.163
CSeq: 1 INVITE
Contact: <sip:192.168.33.163:5022>
P-Asserted-Identity: <sip:0166000000@192.168.33.163:5022;user=phone>
Route: <sip:192.168.33.157:5681;lr>
Max-Forwards: 70
Allow: REFER,INVITE,INFO,ACK,SUBSCRIBE,UPDATE,REGISTER,BYE,CANCEL
Content-Type: application/sdp
Content-Length:   261

v=0
o=cp10 116221159107 116221159108 IN IP4 192.168.33.163
s=SIP Call
c=IN IP4 192.168.33.163
t=0 0
m=audio 6350 RTP/AVP 0 18 8
b=AS:64
a=rtpmap:0 PCMU/8000/1
a=rtpmap:8 PCMA/8000/1
a=rtpmap:18 G729/8000/1
a=fmtp:18 annexb=no
a=ptime:20
a=sendrecv

#ERROR:
Allow: BYE,CANCEL,INFO,INVITE,REFER,REGISTER,SUBSCRIBE,UPDATE

#Description:"
After making the call with INVITE message having "Allow: REFER,INVITE,INFO,ACK,SUBSCRIBE,UPDATE,REGISTER,BYE,CANCEL" with "MANIPULATION_RULE_DEL-ALLOW-INSTANCE1" config.
The outgoing INVITE, delete the wrong Allow Instance. The first Instance need to delete is "REFER".

#Step reproduce:
Step 1: Get the ibcf binary version 7.2.52
Step 2: Get the basic call sipp scenarial
Step 3: Add allow header with value: 
"REFER,INVITE,INFO,ACK,SUBSCRIBE,UPDATE,REGISTER,BYE,CANCEL"
Step 4: Config HMR to delete first field in Allow header "MANIPULATION_RULE_DEL-ALLOW-INSTANCE1"
Step 5: Make the basic call between ibcf
Step 6: Checking out going INVITE allow header is deleted not the first 'allow' value